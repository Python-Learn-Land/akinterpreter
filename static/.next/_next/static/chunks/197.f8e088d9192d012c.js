"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[197],{3197:function(e,t,r){r.r(t),r.d(t,{default:function(){return f}});var s=r(7437),n=r(2265),o=r(6355),l=r(1003),a=r(3718),c=r(8536),i=r(6648);o.Z.registerLanguage("python",a.Z),o.Z.registerLanguage("json",c.Z);var u=e=>{let{type:t,content:r,isBot:n}=e;return(0,s.jsx)("div",{className:"max-w-3/4 ".concat(n?"ml-0 mr-auto":"ml-auto mr-0"),children:(0,s.jsx)("div",{className:"p-3 rounded-lg ".concat(n?"bg-gray-700 text-white":"bg-blue-500 text-white"," max-h-[80vh] overflow-y-auto"),children:"json"===t?(0,s.jsx)(o.Z,{language:"json",style:l.Z,children:r}):"python"===t?(0,s.jsx)(o.Z,{language:"python",style:l.Z,children:r}):r.split(/(\!\[.*?\]\(.*?\)|\[.*?\]\(.*?\))/).map((e,t)=>{if(e.startsWith("![")){let r=e.match(/\!\[(.*?)\]\((.*?)\)/);if(r)return(0,s.jsx)("div",{className:"my-2",children:(0,s.jsx)(i.default,{src:r[2],alt:r[1],layout:"responsive",width:600,height:400})},t)}else if(e.startsWith("[")){let r=e.match(/\[(.*?)\]\((.*?)\)/);if(r)return(0,s.jsx)("a",{href:r[2],target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:r[1]},t)}return(0,s.jsx)("span",{children:e},t)})})})},d=e=>{let{onSendMessage:t,disabled:r}=e,[o,l]=(0,n.useState)(""),a=(0,n.useRef)(null);(0,n.useEffect)(()=>{a.current&&(a.current.style.height="auto",a.current.style.height="".concat(Math.min(a.current.scrollHeight,150),"px"))},[o]);let c=e=>{e.preventDefault(),o.trim()&&!r&&(t(o),l(""))};return(0,s.jsxs)("form",{onSubmit:c,className:"flex items-end",style:{backgroundColor:"#282a36"},children:[(0,s.jsx)("textarea",{ref:a,value:o,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),c(e))},className:"flex-grow p-2 border-none rounded-l resize-none overflow-hidden",placeholder:"Type your message...",disabled:r,rows:1,style:{maxHeight:"150px",backgroundColor:"#44475a",color:"#f8f8f2",border:"1px solid #6272a4"}}),(0,s.jsx)("button",{type:"submit",className:"p-2 text-white rounded-r h-full",disabled:r,style:{backgroundColor:"#6272a4",border:"1px solid #6272a4",cursor:r?"not-allowed":"pointer"},children:"Send"})]})},h=r(2800),f=e=>{let{chatHistory:t}=e,[r,o]=(0,n.useState)(t),[l,a]=(0,n.useState)(!1),[c,i]=(0,n.useState)(null),f=(0,n.useRef)(null),p=(0,n.useRef)(null),x=(0,n.useRef)(null);(0,n.useEffect)(()=>{var e;null===(e=p.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[r]),(0,n.useEffect)(()=>{(async()=>{i(await (0,h.MQ)())})()},[]);let y=(0,n.useCallback)(async e=>{o(t=>[...t,{type:"text",content:e,isBot:!1}]),a(!0),f.current=null;try{let t=await fetch("/api/schat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:c,message:e})});if(!t.ok)throw Error("Network response was not ok");let{session_id:r}=await t.json();x.current&&x.current.close();let s=new EventSource("/api/chat-stream?session_id=".concat(r));x.current=s,s.onmessage=e=>{let t=JSON.parse(e.data);"text"===t.type?o(e=>[...e,{type:"text",content:t.content,isBot:!0}]):"error"===t.type?console.error("Error: ".concat(t.content)):"[DONE]"===t.type?(a(!1),s.close()):o(e=>[...e,{type:"unknown",content:t.content,isBot:!0}])},s.onerror=e=>{console.error("EventSource failed:",e),s.close(),a(!1)}}catch(e){console.error("Error sending message:",e),o(e=>[...e,{type:"text",content:"Error: Unable to get response from the server.",isBot:!0}]),a(!1)}},[c]);return(0,s.jsxs)("div",{className:"flex flex-col h-full max-h-full",style:{backgroundColor:"#282a36",color:"#f8f8f2"},children:[(0,s.jsxs)("div",{className:"flex-grow overflow-y-auto p-4 space-y-4",children:[r.map((e,t)=>(0,s.jsx)(u,{type:e.type,content:e.content,isBot:e.isBot},t)),l&&(0,s.jsx)("p",{className:"italic text-gray-500",children:"\uD83E\uDD16在努力思考。。。"}),(0,s.jsx)("div",{ref:p})]}),(0,s.jsx)("div",{className:"flex-shrink-0 p-4 border-t",children:(0,s.jsx)(d,{onSendMessage:y,disabled:l})})]})}}}]);