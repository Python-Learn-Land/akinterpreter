"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[75],{75:function(e,t,r){r.r(t);var o=r(7437),s=r(2265),l=r(2800);t.default=e=>{let{initialMessages:t=[]}=e,[r,n]=(0,s.useState)(t),[a,i]=(0,s.useState)(""),[d,c]=(0,s.useState)(!1),[u,p]=(0,s.useState)(null),f=(0,s.useRef)(null),h=(0,s.useRef)(null);(0,s.useEffect)(()=>{(0,l.MQ)().then(p)},[]),(0,s.useEffect)(()=>{var e;null===(e=f.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[r]),(0,s.useEffect)(()=>{if(u)return h.current=new EventSource("/api/sse?session_id=".concat(u)),h.current.onmessage=e=>{let t=JSON.parse(e.data);"chat_history"===t.type&&n(t.chat_history)},h.current.onerror=e=>{console.error("EventSource failed:",e)},()=>{var e;null===(e=h.current)||void 0===e||e.close()}},[u]);let x=async e=>{if(!e.trim()||!u)return;let t={role:"user",content:e};n(e=>[...e,t]),i(""),c(!0);try{var r;let t=await fetch("/api/schat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:u,message:e})});if(!t.ok)throw Error("Failed to send message");let o=null===(r=t.body)||void 0===r?void 0:r.getReader();if(!o)throw Error("No reader available");let s={role:"assistant",content:""};for(;;){let{done:e,value:t}=await o.read();if(e)break;for(let e of new TextDecoder().decode(t).split("\n").filter(e=>""!==e.trim())){let t=JSON.parse(e);"text"===t.type&&(s.content+=t.content,n(e=>[...e.slice(0,-1),{...e[e.length-1]},{...s}]))}}}catch(e){console.error("Error sending message:",e),n(e=>[...e,{role:"assistant",content:"Error: Unable to get response from the server."}])}finally{c(!1)}};return(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100vh",backgroundColor:"#1a202c",color:"white"},children:[(0,o.jsxs)("div",{style:{flexGrow:1,overflowY:"auto",padding:"20px"},children:[r.map((e,t)=>(0,o.jsx)("div",{style:{marginBottom:"10px",padding:"10px",borderRadius:"5px",backgroundColor:"assistant"===e.role?"#4a5568":"#3182ce",color:"white",maxWidth:"80%",alignSelf:"assistant"===e.role?"flex-start":"flex-end"},children:e.content},t)),d&&(0,o.jsx)("div",{style:{color:"#a0aec0",fontStyle:"italic"},children:"AI is thinking..."}),(0,o.jsx)("div",{ref:f})]}),(0,o.jsxs)("div",{style:{padding:"20px",borderTop:"1px solid #4a5568",display:"flex"},children:[(0,o.jsx)("input",{type:"text",value:a,onChange:e=>i(e.target.value),onKeyPress:e=>"Enter"===e.key&&x(a),style:{flexGrow:1,padding:"10px",borderRadius:"5px 0 0 5px",border:"1px solid #4a5568",backgroundColor:"#2d3748",color:"white"},placeholder:"Type your message...",disabled:d}),(0,o.jsx)("button",{onClick:()=>x(a),disabled:d,style:{padding:"10px 20px",borderRadius:"0 5px 5px 0",border:"1px solid #4a5568",backgroundColor:"#3182ce",color:"white",cursor:"pointer",opacity:d?.5:1},children:"Send"})]})]})}}}]);