(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6008:function(e,t,r){Promise.resolve().then(r.bind(r,3197))},3197:function(e,t,r){"use strict";r.d(t,{default:function(){return i}});var s=r(7437),n=r(2265),l=r(1907),a=r(728),o=e=>{let{type:t,content:r,isBot:o}=e,c=(e,t)=>(0,s.jsx)("div",{className:"max-h-96 overflow-y-auto my-2",children:(0,s.jsx)(l.Z,{language:t,style:a.Z,children:e})}),i=e=>{try{let t=JSON.parse(e);return c(JSON.stringify(t,null,2),"json")}catch(t){return console.error("Error parsing JSON:",t),(0,s.jsx)("p",{className:"break-words whitespace-pre-wrap",children:e})}};return(0,s.jsx)("div",{className:"max-w-3/4 ".concat(o?"ml-0 mr-auto":"ml-auto mr-0"),children:(0,s.jsx)("div",{className:"p-3 rounded-lg ".concat(o?"bg-gray-200":"bg-blue-500 text-white"," max-h-[80vh] overflow-y-auto"),children:"string"==typeof r?r.split(/(```(json|python)\s*[\s\S]*?```)/).map((e,t)=>{if(e.startsWith("```json")){let r=e.replace(/```json\s*/,"").replace(/\s*```$/,"");return(0,s.jsx)(n.Fragment,{children:i(r)},t)}if(!e.startsWith("```python"))return(0,s.jsx)("p",{className:"break-words whitespace-pre-wrap",children:e},t);{let r=e.replace(/```python\s*/,"").replace(/\s*```$/,"");return(0,s.jsx)(n.Fragment,{children:c(r,"python")},t)}}):"object"==typeof r?i(JSON.stringify(r)):(0,s.jsx)("p",{className:"break-words whitespace-pre-wrap",children:String(r)})})})},c=e=>{let{onSendMessage:t,disabled:r}=e,[l,a]=(0,n.useState)(""),o=(0,n.useRef)(null);(0,n.useEffect)(()=>{o.current&&(o.current.style.height="auto",o.current.style.height="".concat(Math.min(o.current.scrollHeight,150),"px"))},[l]);let c=e=>{e.preventDefault(),l.trim()&&!r&&(t(l),a(""))};return(0,s.jsxs)("form",{onSubmit:c,className:"flex items-end",children:[(0,s.jsx)("textarea",{ref:o,value:l,onChange:e=>a(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),c(e))},className:"flex-grow p-2 border rounded-l resize-none overflow-hidden",placeholder:"Type your message...",disabled:r,rows:1,style:{maxHeight:"150px"}}),(0,s.jsx)("button",{type:"submit",className:"p-2 bg-blue-500 text-white rounded-r h-full",disabled:r,children:"Send"})]})},i=()=>{let[e,t]=(0,n.useState)([]),[r,l]=(0,n.useState)(!1),[a,i]=(0,n.useState)(null),u=(0,n.useRef)(null),p=(0,n.useRef)(null);(0,n.useEffect)(()=>{var e;null===(e=p.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[e]);let h=(0,n.useCallback)(async e=>{t(t=>[...t,{type:"text",content:e,isBot:!1}]),l(!0),u.current=null;try{let t=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e})});if(!t.ok)throw Error("Network response was not ok");let{session_id:r}=await t.json();i(r)}catch(e){console.error("Error sending message:",e),t(e=>[...e,{type:"text",content:"Error: Unable to get response from the server.",isBot:!0}]),l(!1)}},[]);return(0,n.useEffect)(()=>{let e=null;return a&&((e=new EventSource("/api/chat-stream?session_id=".concat(a))).onmessage=r=>{let s;if("[DONE]"===r.data){l(!1),null==e||e.close(),i(null);return}try{let e=JSON.parse(r.data);s={type:e.type||"text",content:e.content||r.data,isBot:!0}}catch(e){console.error("Error parsing SSE data:",e),s={type:"text",content:r.data,isBot:!0}}t(e=>{let t=[...e],r=t[t.length-1];return r&&r.isBot&&r.type===s.type?(r.content+=s.content,[...t.slice(0,-1),r]):[...t,s]})},e.onerror=t=>{console.error("EventSource failed:",t),null==e||e.close(),l(!1),i(null)}),()=>{e&&e.close()}},[a]),(0,s.jsxs)("div",{className:"flex flex-col h-full max-h-full",children:[(0,s.jsxs)("div",{className:"flex-grow overflow-y-auto p-4 space-y-4",children:[e.map((e,t)=>(0,s.jsx)(o,{type:e.type,content:e.content,isBot:e.isBot},t)),r&&(0,s.jsx)("p",{className:"italic text-gray-500",children:"Bot is typing..."}),(0,s.jsx)("div",{ref:p})]}),(0,s.jsx)("div",{className:"flex-shrink-0 p-4 border-t",children:(0,s.jsx)(c,{onSendMessage:h,disabled:r})})]})}}},function(e){e.O(0,[578,971,23,744],function(){return e(e.s=6008)}),_N_E=e.O()}]);