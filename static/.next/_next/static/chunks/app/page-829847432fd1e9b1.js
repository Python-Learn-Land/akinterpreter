(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6008:function(e,t,r){Promise.resolve().then(r.bind(r,3197))},3197:function(e,t,r){"use strict";r.d(t,{default:function(){return l}});var s=r(7437),n=r(2265),o=e=>{let{text:t,isBot:r}=e;return(0,s.jsx)("div",{className:"p-2 ".concat(r?"bg-gray-200":"bg-blue-200"," rounded-lg mb-2"),children:(0,s.jsxs)("p",{children:[r?"\uD83E\uDD16: ":"你: ",t]})})},a=e=>{let{onSendMessage:t,disabled:r}=e,[o,a]=(0,n.useState)("");return(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),o.trim()&&!r&&(t(o),a(""))},className:"mt-4",children:[(0,s.jsx)("input",{type:"text",value:o,onChange:e=>a(e.target.value),className:"w-full p-2 border rounded",placeholder:"在这里输入...",disabled:r}),(0,s.jsx)("button",{type:"submit",className:"mt-2 p-2 bg-blue-500 text-white rounded",disabled:r,children:"Send"})]})},l=()=>{let[e,t]=(0,n.useState)([]),[r,l]=(0,n.useState)(!1),[c,i]=(0,n.useState)(null),u=(0,n.useRef)(""),d=(0,n.useCallback)(async e=>{t(t=>[...t,{text:e,isBot:!1}]),l(!0),u.current="";try{let r=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e})});if(!r.ok)throw Error("Network response was not ok");let{session_id:s}=await r.json();c&&c.close();let n=new EventSource("/api/chat-stream?session_id=".concat(s));i(n),n.onmessage=e=>{if("[DONE]"===e.data){l(!1),n.close();return}try{let r=JSON.parse(e.data);"text"===r.type&&(u.current+=r.content,t(e=>{let t=[...e];return t.length>0&&t[t.length-1].isBot?t[t.length-1].text=u.current:t.push({text:u.current,isBot:!0}),t}))}catch(e){console.error("Error parsing SSE data",e)}},n.onerror=e=>{console.error("EventSource failed:",e),n.close(),l(!1)}}catch(e){console.error("Error sending message:",e),t(e=>[...e,{text:"Error: Unable to get response from the server.",isBot:!0}]),l(!1)}},[]);return(0,n.useEffect)(()=>()=>{c&&c.close()},[c]),(0,s.jsxs)("div",{className:"flex flex-col h-[400px] border rounded p-4",children:[(0,s.jsxs)("div",{className:"flex-grow overflow-y-auto mb-4",children:[e.map((e,t)=>(0,s.jsx)(o,{text:e.text,isBot:e.isBot},t)),r&&(0,s.jsx)("p",{className:"italic text-gray-500",children:"Bot is typing..."})]}),(0,s.jsx)(a,{onSendMessage:d,disabled:r})]})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=6008)}),_N_E=e.O()}]);