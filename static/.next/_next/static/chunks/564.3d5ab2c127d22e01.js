"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[564],{65564:function(e,t,a){a.r(t),a.d(t,{default:function(){return R}});var s=a(57437),r=a(2265),l=a(66648),n=a(57251),o=a(61003),d=e=>{let{type:t,content:a,isBot:d,isLatest:i,onContentRendered:c}=e,f=(0,r.useRef)(null);return(0,r.useEffect)(()=>{i&&f.current&&c()},[a,i,c]),(0,s.jsx)("div",{ref:f,className:"max-w-3/4 ".concat(d?"ml-0 mr-auto":"ml-auto mr-0"),children:(0,s.jsx)("div",{className:"p-3 rounded-lg ".concat(d?"bg-gray-700 text-white":"bg-blue-500 text-white"," max-h-[80vh] overflow-y-auto"),children:(()=>{if("object"==typeof a)return(0,s.jsx)(n.Z,{language:"json",style:o.Z,children:JSON.stringify(a,null,2)});if("string"==typeof a){let e=a.match(/^```(json|python)?\s*([\s\S]*?)```$/);if(e){let t=e[1]||"text",a=e[2].trim();if("json"===t)try{let e=JSON.parse(a);return(0,s.jsx)(n.Z,{language:"json",style:o.Z,children:JSON.stringify(e,null,2)})}catch(e){}return(0,s.jsx)(n.Z,{language:t,style:o.Z,children:a})}return a.includes("def ")||a.includes("import ")||a.includes("print(")?(0,s.jsx)(n.Z,{language:"python",style:o.Z,children:a}):a.split(/(\!\[.*?\]\(.*?\)|\[.*?\]\(.*?\))/).map((e,t)=>{if(e.startsWith("![")){let a=e.match(/\!\[(.*?)\]\((.*?)\)/);if(a)return(0,s.jsx)("div",{className:"relative w-full h-64 my-2",children:(0,s.jsx)(l.default,{src:a[2],alt:a[1],layout:"fill",objectFit:"contain"})},t)}else if(e.startsWith("[")){let a=e.match(/\[(.*?)\]\((.*?)\)/);if(a)return(0,s.jsx)("a",{href:a[2],target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:a[1]},t)}return(0,s.jsx)("span",{className:"whitespace-pre-wrap",children:e},t)})}return(0,s.jsx)("p",{className:"break-words whitespace-pre-wrap",children:String(a)})})()})})},i=a(92800),c=a(49354);let f=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("textarea",{className:(0,c.cn)("flex min-h-[80px] w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-slate-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-800 dark:bg-slate-950 dark:ring-offset-slate-950 dark:placeholder:text-slate-400 dark:focus-visible:ring-slate-300",a),ref:t,...r})});f.displayName="Textarea";var u=a(71538);let m=(0,a(12218).j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:ring-offset-slate-950 dark:focus-visible:ring-slate-300",{variants:{variant:{default:"bg-slate-900 text-slate-50 hover:bg-slate-900/90 dark:bg-slate-50 dark:text-slate-900 dark:hover:bg-slate-50/90",destructive:"bg-red-500 text-slate-50 hover:bg-red-500/90 dark:bg-red-900 dark:text-slate-50 dark:hover:bg-red-900/90",outline:"border border-slate-200 bg-white hover:bg-slate-100 hover:text-slate-900 dark:border-slate-800 dark:bg-slate-950 dark:hover:bg-slate-800 dark:hover:text-slate-50",secondary:"bg-slate-100 text-slate-900 hover:bg-slate-100/80 dark:bg-slate-800 dark:text-slate-50 dark:hover:bg-slate-800/80",ghost:"hover:bg-slate-100 hover:text-slate-900 dark:hover:bg-slate-800 dark:hover:text-slate-50",link:"text-slate-900 underline-offset-4 hover:underline dark:text-slate-50"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),x=r.forwardRef((e,t)=>{let{className:a,variant:r,size:l,asChild:n=!1,...o}=e,d=n?u.g7:"button";return(0,s.jsx)(d,{className:(0,c.cn)(m({variant:r,size:l,className:a})),ref:t,...o})});x.displayName="Button";var p=a(71943),h=a(87592),g=a(22468),b=a(28165);let y=p.v2;p.ZA,p.h_,p.Tr,p.Ee;let v=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(p.fC,{ref:t,className:(0,c.cn)("flex h-10 items-center space-x-1 rounded-md border border-slate-200 bg-white p-1 dark:border-slate-800 dark:bg-slate-950",a),...r})});v.displayName=p.fC.displayName;let k=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(p.xz,{ref:t,className:(0,c.cn)("flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-slate-100 focus:text-slate-900 data-[state=open]:bg-slate-100 data-[state=open]:text-slate-900 dark:focus:bg-slate-800 dark:focus:text-slate-50 dark:data-[state=open]:bg-slate-800 dark:data-[state=open]:text-slate-50",a),...r})});k.displayName=p.xz.displayName,r.forwardRef((e,t)=>{let{className:a,inset:r,children:l,...n}=e;return(0,s.jsxs)(p.fF,{ref:t,className:(0,c.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-slate-100 focus:text-slate-900 data-[state=open]:bg-slate-100 data-[state=open]:text-slate-900 dark:focus:bg-slate-800 dark:focus:text-slate-50 dark:data-[state=open]:bg-slate-800 dark:data-[state=open]:text-slate-50",r&&"pl-8",a),...n,children:[l,(0,s.jsx)(h.Z,{className:"ml-auto h-4 w-4"})]})}).displayName=p.fF.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(p.tu,{ref:t,className:(0,c.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border border-slate-200 bg-white p-1 text-slate-950 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50",a),...r})}).displayName=p.tu.displayName;let w=r.forwardRef((e,t)=>{let{className:a,align:r="start",alignOffset:l=-4,sideOffset:n=8,...o}=e;return(0,s.jsx)(p.h_,{children:(0,s.jsx)(p.VY,{ref:t,align:r,alignOffset:l,sideOffset:n,className:(0,c.cn)("z-50 min-w-[12rem] overflow-hidden rounded-md border border-slate-200 bg-white p-1 text-slate-950 shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50",a),...o})})});w.displayName=p.VY.displayName;let N=r.forwardRef((e,t)=>{let{className:a,inset:r,...l}=e;return(0,s.jsx)(p.ck,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-slate-100 focus:text-slate-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-slate-800 dark:focus:text-slate-50",r&&"pl-8",a),...l})});N.displayName=p.ck.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,checked:l,...n}=e;return(0,s.jsxs)(p.oC,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-slate-100 focus:text-slate-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-slate-800 dark:focus:text-slate-50",a),checked:l,...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(p.wU,{children:(0,s.jsx)(g.Z,{className:"h-4 w-4"})})}),r]})}).displayName=p.oC.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,s.jsxs)(p.Rk,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-slate-100 focus:text-slate-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-slate-800 dark:focus:text-slate-50",a),...l,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(p.wU,{children:(0,s.jsx)(b.Z,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=p.Rk.displayName,r.forwardRef((e,t)=>{let{className:a,inset:r,...l}=e;return(0,s.jsx)(p.__,{ref:t,className:(0,c.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",a),...l})}).displayName=p.__.displayName;let j=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(p.Z0,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-slate-100 dark:bg-slate-800",a),...r})});j.displayName=p.Z0.displayName;var R=e=>{let{initialMessages:t,currentPlan:a}=e,[l,n]=(0,r.useState)(t),[o,c]=(0,r.useState)(""),[u,m]=(0,r.useState)(!1),[p,h]=(0,r.useState)(null),[g,b]=(0,r.useState)(null);(0,r.useRef)(null);let R=(0,r.useRef)(null),S=(0,r.useRef)(null),E=(0,r.useRef)(null),_=(0,r.useRef)(null);(0,r.useEffect)(()=>{(async()=>{h(await (0,i.MQ)())})()},[]),(0,r.useEffect)(()=>{C()},[o]);let Z=(0,r.useCallback)(()=>{_.current&&(_.current.scrollTop=_.current.scrollHeight)},[]);(0,r.useEffect)(()=>{Z()},[l,Z]);let C=()=>{if(S.current){S.current.style.height="auto";let e=S.current.scrollHeight,t=parseInt(getComputedStyle(S.current).lineHeight);S.current.style.height="".concat(Math.min(e,5*t),"px")}},z=(0,r.useCallback)(async e=>{if(e.trim()&&!u){if(n(t=>[...t,{type:"text",content:e,isBot:!1}]),c(""),m(!0),"save_plan"===e.trim().toLowerCase()){try{let e;e="string"==typeof a?JSON.parse(a):a;let t=await (0,i.ef)(e);n(e=>[...e,{type:"text",content:t.message,isBot:!0}])}catch(e){console.error("Error saving plan:",e),n(e=>[...e,{type:"text",content:"Error saving plan. Please try again.",isBot:!0}])}m(!1);return}try{let t=await (0,i.bE)(e);b(t),E.current&&E.current.close();let a=(0,i.cE)(t);E.current=a,a.onmessage=e=>{if("[DONE]"===e.data)m(!1),a.close();else try{let t=JSON.parse(e.data);n(e=>{let a=e[e.length-1];if(!a||a.type!==t.type||!a.isBot)return[...e,{...t,isBot:!0}];{let s={...a,content:a.content+t.content};return[...e.slice(0,-1),s]}})}catch(e){console.error("Error parsing message:",e)}},a.onerror=e=>{console.error("EventSource failed:",e),a.close(),m(!1)}}catch(e){console.error("Error sending message:",e),m(!1)}}},[u,a]),B=e=>{switch(e){case"help":case"go":case"clear_history":case"redo":case"export":z(e);break;case"modify_code":c("modify_step_code=<step> query"),S.current&&S.current.focus()}};return(0,s.jsxs)("div",{className:"flex flex-col h-full bg-gray-900 text-white",children:[(0,s.jsxs)("div",{ref:_,className:"flex-grow overflow-y-auto p-4 space-y-4",children:[l.map((e,t)=>(0,s.jsx)(d,{type:e.type,content:e.content,isBot:e.isBot,isLatest:t===l.length-1,onContentRendered:Z},t)),u&&(0,s.jsx)("p",{className:"italic text-gray-500",children:"\uD83E\uDD16在努力思考。。。"}),(0,s.jsx)("div",{ref:R})]}),(0,s.jsxs)("div",{className:"flex-shrink-0 border-t border-gray-700 p-2",children:[(0,s.jsx)("div",{className:"flex justify-start mb-0.5",children:(0,s.jsx)(v,{className:"bg-gray-800 text-white inline-flex rounded-md",children:(0,s.jsxs)(y,{children:[(0,s.jsx)(k,{className:"text-white px-3 py-1",children:"命令"}),(0,s.jsxs)(w,{className:"bg-gray-800 text-white",children:[(0,s.jsx)(N,{onSelect:()=>B("help"),children:"帮助"}),(0,s.jsx)(N,{onSelect:()=>B("go"),children:"执行计划"}),(0,s.jsx)(N,{onSelect:()=>B("clear_history"),children:"清空聊天记录"}),(0,s.jsx)(N,{onSelect:()=>B("modify_code"),children:"修改代码"}),(0,s.jsx)(N,{onSelect:()=>B("redo"),children:"重新执行"}),(0,s.jsx)(j,{}),(0,s.jsx)(N,{onSelect:()=>B("export"),children:"导出"})]})]})})}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(f,{ref:S,value:o,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),z(o))},className:"flex-grow p-2 bg-gray-800 border border-gray-700 rounded-md resize-none",placeholder:"输入消息... (Shift+Enter 换行)",disabled:u,rows:1,style:{minHeight:"38px",maxHeight:"120px",overflow:"auto"}}),(0,s.jsx)(x,{onClick:()=>z(o),className:"p-2 bg-blue-600 text-white rounded-md",disabled:u,children:"发送"})]})]})]})}}}]);